# 直方图均衡处理实验报告



自选一张灰度图像，编程实现直方图均衡处理。

要求：1、基于累积分布函数实现直方图均衡部分需要自写代码；

2、以实验报告形式提交结果，报告内容应包括自写源码、直方图均衡处理前后的图像和直方图。



### 1 实验内容与要求







本次实验将以下图为例，进行直方图均衡处理

<img src="D:\浙江大学\课程\2022春夏课程\数字图像处理与机器视觉\CVprojects\Project2\report\GrayPhoto.jpg" alt="GrayPhoto" style="zoom:80%;" />



### 2 实验原理

[(25条消息) 数字图像处理(17): 直方图均衡化处理_TechArtisan6的博客-CSDN博客_图像直方图均衡化](https://blog.csdn.net/zaishuiyifangxym/article/details/89813977)



直方图均衡化概念

***\*直方图均衡化\**** (***\*Histogram Equalization\****) 就是把一个已知灰度概率密度分布的图像经过一种变换，使之演变为一幅具有***\*均匀\****灰度概率密度分布的新图像。



直方图均衡化的理论基础
前提：如果一幅图像占有全部可能的灰度级，并且均匀分布。

结论：该图像具有高对比度和多变的灰色色调。

外观：图像细节丰富，质量更高。

 

直方图均衡化的步骤
（1）计算累计直方图；

（2）将累计直方图进行区间转换；

（3）在累计直方图中，概率相近的原始值，会被处理为相同的值








伪代码？[(25条消息) 图像直方图均衡化_dayenglish的专栏-CSDN博客](https://blog.csdn.net/dayenglish/article/details/43093399)
$$
\begin{array}{ll}
	\text{Image Histogram Equalization Algorithm}\\
	\hline
  \mathbf{Input}: image\\
  \mathbf{Result}:\mathrm{A\ path\ } \Gamma \mathrm{\ from\ }x_{init} \mathrm{to\ } x_{goal}\\
  \Gamma .init() & 以x_{init}为根节点，建立搜索树\\
  \mathbf{for\ }i=1\ to\ n\ do \\
  \ \ \ \ \ \ x_{rand}\gets Sample(M) & 在可行空间中随机采样\\
  \ \ \ \ \ \ x_{near}\gets Near(x_{rand},\Gamma)  & 找到树中离采样点最近的树节点\\
  \ \ \ \ \ \ x_{near}\gets Steer(x_{rand},x_{near},StepSize) & 根据机器人的执行能力生成新的节点和新的路径\\
  \ \ \ \ \ \ \mathbf{if\ }CollisionFree(x_{near})\mathbf{then} & 无碰撞检测，根据成本进行树结构优化\\
  \ \ \ \ \ \ \ \ \ \ \ \ X_{near}\gets NearC(\Gamma,x_{near}) & 选择多个邻节点\\
  \ \ \ \ \ \ \ \ \ \ \ \ X_{min}\gets ChooseParent(X_{near},x_{near},x_{new}) & 评估各邻节点作为父节点下的总路径长度\\
  \ \ \ \ \ \ \ \ \ \ \ \ \Gamma.addNodEdge(x_{min},x_{new}) & 根据总最短路径选择父节点\\
  \ \ \ \ \ \ \ \ \ \ \ \ \Gamma.rewire() & 优化邻节点路径\\
\end{array}
$$


### 3 源代码

```python
import cv2
from PIL import Image, ImageDraw, ImageFont
import numpy as np
import matplotlib.pyplot as plt

def Img_Hist(img):
    '''
    计算图像的直方图
    输入：灰度图像
    输出：以一维向量保存的直方图数据
    '''
    hist=np.zeros(256,dtype=int) # 初始化直方图数据

    # 统计直方图数据
    for i in range(img.shape[0]):
        for j in range(img.shape[1]):
            k = img[i][j]
            hist[k] += 1
    
    return hist

def Equal_Hist(hist, img):
    '''
    直方图均衡处理
    输入：原始图像直方图数据，原始图像
    输出：处理后图像
    '''
    Tr = Cal_Tr(hist, img) # 计算Tr
    
    new_img = np.zeros(shape=(img.shape[0],img.shape[1]),dtype=np.uint8)
    
    # 对原图像进行映射
    for k in range(img.shape[0]):
        for l in range(img.shape[1]):
            new_img[k][l] = Tr[img[k][l]]
            
    return new_img

def Cal_Tr(hist, img):
    '''
    计算Tr
    输入：原始图像直方图数据，原始图像
    输出：Tr一维数组
    '''
    Pr=np.zeros(256,dtype=float)  # 初始化频率分布
    N = img.shape[0]*img.shape[1]
    for i in range(256):
        Pr[i]=hist[i]/N # 统计频率

    # 计算Tr
    Tr=np.zeros(256,dtype=float)  # 初始化Tr
    temp = 0
    for m in range(256):
        temp += 255*Pr[m]
        Tr[m] = np.uint8(round(temp))

    return Tr

if __name__ == '__main__':

    # 读取原始图像
    img = cv2.imread('GrayPhoto.jpg', cv2.IMREAD_GRAYSCALE)

    #计算原图的直方图
    origin_hist = Img_Hist(img)

    # 直方图均衡化
    new_img = Equal_Hist(origin_hist,img)

    # 计算处理后图像的直方图
    new_hist = Img_Hist(new_img)

    cv2.imshow('origin_image',img)
    cv2.imshow('new_image',new_img)
    cv2.imwrite('new_image.jpg', new_img)

    # 绘制灰度直方图
    plt.figure(1)
    plt.subplot( 1, 2, 1 )
    plt.plot(np.arange(256), origin_hist, 'r', linewidth=1.5, c='black')
    plt.tick_params(labelsize=15)
    plt.title("Origin",fontdict={'weight':'normal','size': 20})
    plt.xlabel("Histogram",fontdict={'weight':'normal','size': 15})
    plt.ylabel("Number of Pixels",fontdict={'weight':'normal','size': 15})

    plt.subplot( 1, 2, 2 )
    plt.plot(np.arange(256), new_hist, 'r', linewidth=1.5, c='black')
    plt.tick_params(labelsize=15)
    plt.title("New",fontdict={'weight':'normal','size': 20})
    plt.xlabel("Histogram",fontdict={'weight':'normal','size': 15})
    plt.ylabel("Number of Pixels",fontdict={'weight':'normal','size': 15})

    plt.show()

    print('Equalization has done.')

    K = cv2.waitKey(0)
```



### 4 实验结果与分析

#### 4.1 图像

<img src="D:\浙江大学\课程\2022春夏课程\数字图像处理与机器视觉\CVprojects\Project2\report\img.png" alt="img" style="zoom:72%;" />

从图像中可以看出



#### 4.2 直方图

<img src="D:\浙江大学\课程\2022春夏课程\数字图像处理与机器视觉\CVprojects\Project2\report\Histogram.png" alt="Histogram" style="zoom:72%;" />

从直方图中可以看出